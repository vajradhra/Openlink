<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT å°è©±æ©Ÿå™¨äºº</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        body { background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%); }
        .chat-bubble-user { background: #3b82f6; color: #fff; border-radius: 1.2em 1.2em 0 1.2em; }
        .chat-bubble-ai { background: #f3f4f6; color: #222; border-radius: 1.2em 1.2em 1.2em 0; }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <div class="flex-1 flex flex-col items-center justify-center py-8">
        <div class="w-full max-w-xl bg-white rounded-2xl shadow-xl p-6 flex flex-col h-[70vh]">
            <h1 class="text-2xl font-bold text-blue-700 mb-4 text-center">ğŸ¤– ChatGPT å°è©±æ©Ÿå™¨äºº</h1>
            <div id="chatArea" class="flex-1 overflow-y-auto space-y-4 px-1 mb-4">
                <!-- å°è©±ç´€éŒ„æœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
            </div>
            <form id="chatForm" class="flex items-end space-x-2">
                <input id="userInput" type="text" autocomplete="off" placeholder="è«‹è¼¸å…¥è¨Šæ¯..." class="flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none text-base" required />
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold transition-all">ç™¼é€</button>
            </form>
            <div class="mt-2 text-xs text-gray-400 text-center">Powered by OpenAI API | ç¹é«”ä¸­æ–‡ä»‹é¢</div>
        </div>
    </div>

    <!-- OpenAI API Key è¨­å®šï¼ˆå½ˆçª—ï¼‰ -->
    <div id="apiKeyModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-xs flex flex-col items-center">
            <h2 class="text-lg font-bold mb-4 text-blue-700">è«‹è¼¸å…¥æ‚¨çš„ OpenAI API Key</h2>
            <input id="apiKeyInput" type="password" placeholder="sk-..." class="w-full px-3 py-2 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-blue-400" />
            <button id="saveApiKey" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold">å„²å­˜</button>
            <div class="mt-2 text-xs text-gray-400 text-center">API Key åƒ…å„²å­˜æ–¼æœ¬åœ°ç€è¦½å™¨</div>
        </div>
    </div>

    <script>
    // å„²å­˜å°è©±ä¸Šä¸‹æ–‡
    let messages = [];
    let apiKey = localStorage.getItem('openai_api_key') || '';

    // é¡¯ç¤ºAPI Keyè¼¸å…¥å½ˆçª—
    function showApiKeyModal() {
        $('#apiKeyModal').removeClass('hidden');
    }
    function hideApiKeyModal() {
        $('#apiKeyModal').addClass('hidden');
    }

    // å„²å­˜API Key
    $('#saveApiKey').on('click', function() {
        const key = $('#apiKeyInput').val().trim();
        if (key.startsWith('sk-')) {
            localStorage.setItem('openai_api_key', key);
            apiKey = key;
            hideApiKeyModal();
        } else {
            alert('è«‹è¼¸å…¥æ­£ç¢ºçš„ OpenAI API Keyï¼ˆä»¥ sk- é–‹é ­ï¼‰');
        }
    });

    // åˆæ¬¡è¼‰å…¥æª¢æŸ¥API Key
    $(document).ready(function() {
        if (!apiKey) {
            showApiKeyModal();
        } else {
            hideApiKeyModal();
        }
        renderChat();
    });

    // è™•ç†é€å‡ºè¨Šæ¯
    $('#chatForm').on('submit', async function(e) {
        e.preventDefault();
        const userMsg = $('#userInput').val().trim();
        if (!userMsg) return;
        $('#userInput').val('');
        addMessage('user', userMsg);
        renderChat();
        await sendToOpenAI();
    });

    // æ–°å¢è¨Šæ¯åˆ°å°è©±ç´€éŒ„
    function addMessage(role, content) {
        messages.push({ role, content });
    }

    // æ¸²æŸ“å°è©±å€
    function renderChat() {
        const chatArea = $('#chatArea');
        chatArea.empty();
        if (messages.length === 0) {
            chatArea.append('<div class="text-gray-400 text-center mt-8">è«‹é–‹å§‹èˆ‡ ChatGPT å°è©±å§ï¼</div>');
        } else {
            messages.forEach(msg => {
                if (msg.role === 'user') {
                    chatArea.append(`<div class="flex justify-end"><div class="chat-bubble-user px-4 py-2 max-w-[80%] mb-1">${escapeHtml(msg.content)}</div></div>`);
                } else if (msg.role === 'assistant') {
                    chatArea.append(`<div class="flex justify-start"><div class="chat-bubble-ai px-4 py-2 max-w-[80%] mb-1">${escapeHtml(msg.content)}</div></div>`);
                }
            });
            chatArea.scrollTop(chatArea[0].scrollHeight);
        }
    }

    // å‚³é€è¨Šæ¯åˆ° OpenAI API
    async function sendToOpenAI() {
        if (!apiKey) {
            showApiKeyModal();
            return;
        }
        addMessage('assistant', '<span class="animate-pulse">æ€è€ƒä¸­...</span>');
        renderChat();
        try {
            const res = await $.ajax({
                url: 'https://api.openai.com/v1/chat/completions',
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + apiKey,
                    'Content-Type': 'application/json'
                },
                data: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: messages.filter(m => m.role !== 'assistant' || !m.content.includes('æ€è€ƒä¸­...')),
                    temperature: 0.7
                })
            });
            // ç§»é™¤ã€Œæ€è€ƒä¸­...ã€
            messages = messages.filter(m => !(m.role === 'assistant' && m.content.includes('æ€è€ƒä¸­...')));
            addMessage('assistant', res.choices[0].message.content.trim());
            renderChat();
        } catch (err) {
            messages = messages.filter(m => !(m.role === 'assistant' && m.content.includes('æ€è€ƒä¸­...')));
            addMessage('assistant', 'âš ï¸ ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ API Key æˆ–ç¶²è·¯é€£ç·šã€‚');
            renderChat();
        }
    }

    // HTML è½‰ç¾©
    function escapeHtml(text) {
        return text.replace(/[&<>"']/g, function (c) {
            return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c];
        });
    }
    </script>
</body>
</html> 